@(groupId : String, groupName : String, userId : String, inviteToken : String) @template(1){

	<script type="text/javascript" src="/assets/this/js/adapter.js"></script>
	<script type="text/javascript" src="/assets/this/js/hyper.socket.js"></script>
	<script type="text/javascript" src="/assets/this/js/hyper.timeline.js"></script>
	<script type="text/javascript" src="/assets/this/js/scripts.js"></script>


	
	<div id="addMembersModal" class="modal fade" role="dialog">
		<div class="modal-dialog">
			<!-- Modal content-->
			<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal">&times;</button>
				<h4 class="modal-title">Add Member</h4>
			</div>
			<div class="modal-body">
				<label>Group invitation link</label>
				<div class="input-group">
					<input type="text" class="form-control" id="invite"> <span
						class="input-group-addon" onclick="createInvite2()"> Create
					</span> <span class="input-group-addon" onclick="deleteInvite2()">
						Delete </span>
				</div>
				<label>Add Members manually</label>

				<div id="imaginary_container">
					<div class="input-group stylish-input-group">
						<input type="text" class="form-control" placeholder="Search"
							onchange="candidate_search(this.value)"> <span
							class="input-group-addon">
							<button type="submit">
								<span class="fa fa-search"></span>
							</button>
						</span>
					</div>
				</div>
				<ul class="media-list" id="candidateList">
				</ul>
			</div>
		</div>
		</div>
	</div>
	
	<div id="participantModal" class="modal fade" role="dialog">
		<div class="modal-dialog">
			<!-- Modal content-->
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">&times;</button>
					<h4 class="modal-title">Share preferences</h4>
				</div>
				<div class="modal-body">
					<div class="row">
						<div class="col-md-4">
							<div class="panel panel-red" onclick="kurentoStart(0)">
								<div class="panel-heading" style="text-align: center;">
									<i class="fa fa-video-camera" style="font-size: 6em;"></i>
								</div>
								<a href="#">
									<div class="panel-footer">
		                                <span class="pull-left">Camera</span>
		                                <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
		                                <div class="clearfix"></div>
		                            </div>
	                            </a>
							</div>
						</div>
						<div class="col-md-4">
							<div class="panel panel-green" onclick="kurentoStart(1)">
								<div class="panel-heading " style="text-align: center;">
									<i class="fa fa-desktop" style="font-size: 6em;"></i>
								</div>
								<a href="#">
									<div class="panel-footer">
		                                <span class="pull-left">Screen</span>
		                                <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
		                                <div class="clearfix"></div>
		                            </div>
	                            </a>
							</div>
						</div>
						<div class="col-md-4">
							<div class="panel panel-primary" onclick="kurentoStart(2)">
								<div class="panel-heading " style="text-align: center;">
									<i class="fa fa-eye" style="font-size: 6em;"></i>
								</div>
								<a href="#">
									<div class="panel-footer">
		                                <span class="pull-left">Nothing</span>
		                                <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
		                                <div class="clearfix"></div>
		                            </div>
	                            </a>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	
	<div id="createTagModal" class="modal fade" role="dialog">
		<div class="modal-dialog">
			<!-- Modal content-->
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">&times;</button>
					<h4 class="modal-title">Create TAG</h4>
				</div>
				<form id="createTagForm">
					<div class="modal-body">
						<div class="form-group">
							<label class="control-label">TAG Name:</label>
							<input class="form-control" type="text" id="tagTitle" /> 
						</div>
					</div>
					<div class="modal-footer">
						<div class="input-group pull-right">
							<input type="submit" class="btn btn-success" id="addMembers"/>
						</div>
						<div class="clearfix"></div>
					</div>
				</form>
			</div>
		</div>
	</div>
	

	<div class="container-fluid">
		<div class="container">	
			<div>@group_video(groupId,userId)</div>
		</div>
	</div>
	<script>
		var mySearch = {
			source: function(query,process){
				Signaling.searchInsideGroup("@groupId",query, function( array ) {
					console.log(array);
					process(array);
				});			
			},
			displayText: function(item){
				return item.title;
			},
			highlighter: function(item){
				if(item.type=="tag"){
					return "<i class='fa fa-tag'></i> "  + item.title + " <small>("+friendlyTime(item.time)+")</small>";
				}else {
					return "<i class='fa fa-font'></i> " + item.name ;
				}
			},
			matcher: function(item){
				return true;
			},
			updater:function(item){
				if(item.type=="tag"){
					timeline.setHistoric(item.time);
				}
				console.log(item);
				return item;
			}
		};
		function createInvite2(){
			Signaling.createInvite("@groupId",function(token){
				$("#invite").val($(location).attr('protocol')+"//"+$(location).attr('host')+"/join/@groupId/" + token);	
			});
		}

		function deleteInvite2(){
			Signaling.deleteInvite("@groupId",function(){
				$("#invite").val("");	
			});
		}
		
		function del_user_group(uid) {
			var success = function() {
				document.location = document.location;
			};
			Signaling.removeUserGroup("@groupId", uid, success);
		}
		
		function add_user_group(uid) {
			var success = function() {
				document.location = document.location;
			};
			Signaling.addUserGroup("@groupId", uid, success);
		}
		
		function candidate_search(query) {
		
			var result = function(array) {
				
				var html = "";
				for ( var i in array) {
					var uid = array[i].uid;
					var name = array[i].name;

					var style2='style="background-image:url(/photo/'+uid+');height:40px;width:40px"';
					var add_button = "<i style='color:green' onclick='add_user_group(\"" + uid	+ "\")' class='fa fa-plus'></i>";
					html += '<div class="media"><a '+style2+' class="pull-left media-object circular"></a>'+
					'<div class="media-body"><h5>'+name+' | User | '+add_button+'</h5></div></div>';
				}
				$("#candidateList").html(html);
			};
			Signaling.searchGroupCandidates("@groupId", query, result);
		}
		
		function onKurentoOpen(){
			console.log("WebSocket Ok!");
			var attrs = parseQuery(document.location.search);
			if(attrs.time){
				timeline.setHistoric(new Date(attrs.time));
			}
		}
		
		function kurentoStart(mode){
			Kurento.start("@groupId",mode,onKurentoOpen ,participantInfo, videoStream, mixedStream, intervalRecorded, messageArrived,tagArrived, onContentArrived);
			$('#participantModal').modal('hide');
		}
		
		$(document).ready(function() {
			switchTab("#mytabs","#mybtns",1);
			$('#participantModal').modal('show');
			$('#searchNav').show();
			$('#searchText').typeahead(mySearch);	
			
			$("#navbar-list").append("<li><a>@groupName</a></li>");
			
			
			$("#createTagForm").submit(function(event){
				event.preventDefault();
				$("#createTagModal").modal('hide');
				var id = makeid();
				var title = $("#tagTitle").val();
				var content = "";

				unsaved_tags.push({
					id : id,
					title : title,
					content : content
				});
				timeline.addTag(id, title);
				$("#saveButton").removeClass("hidden");
			});
			
			
			
			$("#refresh-button").click(function() {
				document.location = document.location;
			});
			
			$("#home-button").click(function() {
				document.location = "/";
			});
	
			@if(inviteToken!=null){
				$("#invite").val($(location).attr('protocol')+"//"+$(location).attr('host')+"/join/@groupId/@inviteToken");	
			}
		
			
		
		});	
	</script>
}
