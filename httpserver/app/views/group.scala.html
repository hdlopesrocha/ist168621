@(groupId : String, groupName : String, userId : String) @template(1){
	<script type="text/javascript" src="/assets/js/jquery.js"></script>
	<script type="text/javascript" src="/assets/js/adapter.js"></script>
	<script type="text/javascript" src="/assets/js/signaling.js"></script>
	<script type="text/javascript" src="/assets/js/participant.js"></script>
	<script type="text/javascript" src="/assets/js/kurento_main.js"></script>
	<script type="text/javascript" src="/assets/js/webrtc.js"></script>
	<script type="text/javascript" src="/assets/timeline/vis.js"></script>
	<script type="text/javascript" src="/assets/js/hyper_timeline.js"></script>
	<link type="text/css" href="/assets/timeline/vis.css" rel="stylesheet" />

	<div class="container-fluid">
		<div class="container">	
			<div class="row row-centered">
				<div class="btn-group col-centered" role="group" id="mybtns">
				  <button type="button" onclick="switchTab('#mytabs','#mybtns',1)" class="btn btn-default"><i class="fa fa-video-camera"></i></button>
				  <button type="button" onclick="switchTab('#mytabs','#mybtns',2)" class="btn btn-default"><i class="fa fa-comments"></i></button>
				  <button type="button" onclick="switchTab('#mytabs','#mybtns',3)" class="btn btn-default"><i class="fa fa-users"></i></button>
				</div>
			</div>
	
			<div id="mytabs" style="padding-top: 20px;">
				<div>@group_video(groupId,userId)</div>
				<div>@group_messenger()</div>
				<div>@group_friends(groupId,userId)</div>
			</div>
		</div>
	</div>
<script>
		var participants = {};
		var timeline = null;
		var current_offset=0;
		var rendered_intervals = {};
	
		// TIMELINE
		var items = new vis.DataSet({
			type : {
				start : 'ISODate',
				end : 'ISODate'
			}
		});
	
		
	
	
		$(document).ready(function() {
			switchTab("#mytabs","#mybtns",1);
			
			$("#navbar-list").append("<li><a>@groupName</a></li>");
		
			timeline = HyperTimeline.create(items, "timeline",
				function(offset) {
					console.log("HISTORIC",offset);
					// current request
					current_offset = offset;
					Kurento.receiveHistoric(selected_user,current_offset);
					real_time = false;
				}, 
				function() {
			
					console.log("REALTIME");
					// realtime request
					Kurento.receiveRealtime(selected_user);
	
					real_time = true;
				}
			);
			playStop();
	
	
	
	
			var kvideo = function(streamUrl) {
				var video = document.getElementById("myvideo");
				video.src = streamUrl;
				return video;
			}
			
			var mvideo = function(streamUrl) {
				var video = document.getElementById("mymixed");
				video.src = streamUrl;
				return video;
			}
			
			var kparticipants = function(userId, email) {
				if (!participants[userId]) {
					$("#msgMember"+userId).attr('class', "pull-left media-object circular circular-online" );				
					$("#vidMember"+userId).attr('class', "pull-left media-object circular circular-online" );				

					participants[userId] = email;
				}
			}
			
			var kmessage = function(userId,time,text, name){
				$("#messagesList").append(
					'<li class="media"><div class="media-body"><div class="media">' +
					'<a class="pull-left" href="#"><img class="media-object img-circle"  style="height: 40px;" src="/photo/'+userId+'" /></a>' +
					'<div class="media-body">' +text+ '<br /> <small class="text-muted">' +name +' | '+time+'</small>'+
					'<hr /></div></div></div></li>'
				);
			}
			
			var firstRecording = true;
			
			var kinterval = function(array){
				console.log("REC",array);
				for (var id in array){
					var start = array[id][0];
					var end = array[id][1];
					
					var inter = rendered_intervals[id];
					
					if(inter){
						items.remove(id);
					}
			
					items.add({
						id : id,
						group:'rec',
						content : "&nbsp;",
				      	editable: false,
				      	selectable: false,
						start : start,
						end : end
					});
					rendered_intervals[id] = true;
					
				
				}
				if (firstRecording) {
					firstRecording = false;

					timeline.fit({
						animation : false
					});
				}
			}
			
	
			
			
			
			Kurento.start("@groupId", kparticipants, kvideo, mvideo, kinterval, kmessage);
	
			$("#refresh-button").click(function() {
				document.location = document.location;
			});
			
			$("#home-button").click(function() {
				document.location = "/";
			});
	
			Signaling.listGroupMembers("@groupId",function(array) {
				for ( var i in array) {
					var uid = array[i].uid;
					var name = array[i].name;

					var del_button = "<i style='color:red' onclick='del_user_group(\""+ uid+ "\")' class='fa fa-times'></i>";
					var onclick = 'onclick=\'select_user("'+uid+'")\'';
					var style1='style="background-image:url(/photo/'+uid+');height:100px;width:100px"';
					var style2='style="background-image:url(/photo/'+uid+');height:40px;width:40px"';

					
					$("#membersList").append(
							'<div class="media" '+ onclick+'>'+
							'<a id="vidMember'+uid+'" '+style2+' class="pull-left media-object circular"></a>'+
							'<div class="media-body"><h5>'+name+' | User | '+del_button+'</h5>  <small class="text-muted">Active From 3 hours</small></div></div>'
					);
					
					
					$("#videoMembers").append(
						'<div class="media" '+ onclick+'>'+
						'<a id="vidMember'+uid+'" '+style2+' class="pull-left media-object circular circular-offline"></a>'+
						'<div class="media-body"><h5>'+name+' | User</h5><small class="text-muted">Active From 3 hours</small></div></div>'
					);
					
					$("#messengerMembers").append(
						'<div class="media">'+
						'<a id="msgMember'+uid+'" '+style2+' class="pull-left media-object circular circular-offline"></a>'+
						'<div class="media-body"><h5>'+name+' | User</h5><small class="text-muted">Active From 3 hours</small></div></div>'
					);
				}
			});
		});
	
	

		
	</script>
}
