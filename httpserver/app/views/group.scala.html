@(groupId : String, groupName : String, userId : String)

<html>
	<head>
		<script type="text/javascript" src="/assets/js/jquery.js"></script>	
		<script type="text/javascript" src="/assets/js/signaling.js"></script>
		<script type="text/javascript" src="/assets/js/webrtc.js"></script>	
	</head>
	<body>
		<button id="logout-button">Logout</button>		
		<button id="home-button">Home</button>
		<button id="refresh-button">Refresh</button>
		<h1>@groupName</h1>
		
		<h3>Add Members</h3>
		&nbsp;Search:<input type="text" onchange="candidate_search(this.value)"/>
		<ul id="candidate-list"></ul>
		
		
		<h3>Members List</h3>
		<ul id="member-list"></ul>
		
		<script>
			$( document ).ready(function() {
				function makeToken()
				{
				    var text = "";
				    var possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
				    for( var i=0; i < 20; i++ )
				        text += possible.charAt(Math.floor(Math.random() * possible.length));
				    return text;
				}
				
				var token = makeToken();
				var ice_candidates = [];				
				var sdp_list = [];				

				
				webrtc_init(function(icecand){
					
					var success = function(){
					//	alert("success");
					};
					var error = function(){
						alert("error");
					};
					
					ice_candidates.push(icecand);
					var data = JSON.stringify(icecand);
					
					Signaling.postIceCandidate("@groupId",token,data,success,error);

						
				},function(sdp){
					var success = function(){
						console.log(JSON.stringify(sdp));
						Signaling.publish("sdp:@groupId",function(){},function(){});					
						console.log("publish[@groupId]");
					};
					var error = function(){
						alert("error");
					};
					
					sdp_list.push(sdp);
					var data = JSON.stringify(sdp);
					
					Signaling.postSdp("@groupId",token,data,success,error);

					
					
					
				});
				
				console.log("subscribe[@groupId]");
				Signaling.subscribe("sdp:@groupId",function(result){
					Signaling.listGroupMembersProperties("@groupId", function(array){
						console.log("=========================");		
						for(var uid  in  array){
							if("@userId" != uid){
								
								var userInfo = array[uid];
								for(var i in userInfo.ices){
									var userIce = userInfo.ices[i];
									webrtc_ice_candidate(userIce);
								}
								for(var i in userInfo.sdps){
									var userSdp = userInfo.sdps[i];
									webrtc_remote_description(userSdp);
								}
							}
							
						}
					});
				});	
				
				$("#logout-button").click(function(){
					Signaling.logout(function(){
						document.location = document.location;
					})
				});	
				$("#refresh-button").click(function(){
					document.location = document.location;
				});
				$("#home-button").click(function(){
					document.location = "/";
				});
				Signaling.listGroupMembers("@groupId", function(array){
					var html = "";
					for(var i  in array){
						
						
						var del_button = "<button onclick='del_user_group(\""+array[i].id+"\")'>remove</button>";
						//var sdp_button = "<button onclick='get_sdp(\""+array[i].mid+"\")'>sdp</button>";
						html += "<li>"+array[i].email+del_button+"</li>";
					}
					$("#member-list").html(html);
				});
			});
			
			function del_user_group(uid){
				var success = function(){
					document.location = document.location;
				};
				
				Signaling.removeUserGroup("@groupId",uid,success);
			}

			
			function add_user_group(uid){
				var success = function(){
					document.location = document.location;
				};
				
				Signaling.addUserGroup("@groupId",uid,success);
			}
			
			function candidate_search(query){
				var result = function(array){
					var html = "";
					for(var i  in array){
						var add_button = "<button onclick='add_user_group(\""+array[i].id+"\")'>add</button>";
						html += "<li>"+array[i].email+add_button+"</li>";
					}
					$("#candidate-list").html(html);	
				};
				Signaling.searchGroupCandidates("@groupId",query,result);
			}
			
		</script>
	</body>
</html>